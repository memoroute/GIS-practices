# 空气质量克里金插值系统

## 系统概述

该系统实现了一个完整的工作流程，用于空气质量数据（特别是PM2.5浓度）的地理空间插值，采用克里金法。该系统设计为模块化、可配置，并能够处理真实和合成数据。

## 核心组件

### 1. 数据准备模块

数据准备模块处理：

- **数据加载和生成**：可以从CSV文件加载真实监测数据，或生成具有真实空间模式的合成样本数据。
- **异常值检测和处理**：使用z分数方法识别和处理异常值。
- **坐标系统转换**：在地理坐标（WGS84）和投影坐标系统之间转换。
- **网格参数计算**：根据数据范围确定适当的插值网格。

### 2. 克里金模块

克里金模块实现：

- **变异函数分析**：计算和建模数据的空间自相关结构。
- **三种变异函数模型**：支持球形、指数和高斯模型，具有自动参数拟合功能。
- **普通克里金算法**：实现核心克里金插值算法。
- **KDTree优化**：使用最近邻选择为大型数据集提供加速克里金。

克里金的数学基础基于以下原则：

1. **变异函数估计**：实验变异函数计算为：
   γ(h) = (1/2N(h)) * Σ[Z(xi) - Z(xi+h)]²
   其中N(h)是距离为h的点对数量。

2. **变异函数建模**：实验变异函数与理论模型拟合：
   - 球形：γ(h) = c0 + c1 * [1.5(h/a) - 0.5(h/a)³]（当h ≤ a时），c0 + c1（当h > a时）
   - 指数：γ(h) = c0 + c1 * [1 - exp(-h/a)]
   - 高斯：γ(h) = c0 + c1 * [1 - exp(-h²/a²)]
   其中c0是块金效应，c1是基台值，a是变程。

3. **克里金方程**：普通克里金估计器为：
   Z*(x0) = Σ λi * Z(xi)
   其中λi是通过解决以下方程得到的权重：
   Σ λj * γ(xi-xj) + μ = γ(xi-x0)（对所有i成立）
   Σ λi = 1
   其中μ是拉格朗日乘子。

### 3. 可视化模块

可视化模块创建：

- **监测站点地图**：显示输入数据点的分布和值。
- **插值等值线图**：通过等值线可视化克里金预测。
- **不确定性地图**：将克里金方差显示为预测不确定性的度量。
- **变异函数图**：显示实验和建模的变异函数。
- **交互式网络地图**：使用Folium创建基于HTML的地图，用于交互式探索。

### 4. 验证模块

验证模块：

- **交叉验证**：实现k折交叉验证来评估预测准确性。
- **误差指标**：计算RMSE、MAE、MAPE和R²统计数据。
- **GeoTIFF导出**：以GeoTIFF格式保存插值结果和方差。

## 主要特点

1. **可配置参数**：所有系统参数都可以通过单个YAML配置文件进行调整。
2. **全面可视化**：数据和结果的多种可视化方法。
3. **不确定性量化**：提供克里金方差作为预测可靠性的度量。
4. **交叉验证**：包括验证和评估预测准确性的方法。
5. **性能优化**：使用KDTree高效处理较大的数据集。
6. **GIS集成**：以标准GIS格式（GeoTIFF）导出结果。
7. **交互式网络地图**：创建浏览器可查看的地图，便于数据探索。

## 使用示例

系统可以使用默认配置运行：

```bash
python main.py
